# vim: set ft=ruby :
require 'crab'

opts = Trollop::options do
  banner <<-BANNER
crab testcase list: displays all testcases in Rally in a story as Cucumber scenarios

Usage: crab testcase list <story> [options]"
  BANNER
  opt :language, "Language to display Cucumber features in (ISO code)", :default => "en", :short => "-l"
end

id = ARGV.shift
unless id
  $stderr.puts "Error: No story ID provided."
  system "crab-testcase-help"
  exit 1
end

Crab::Rally.new do |rally|
  story = rally.find_story_with_id id

  puts Array(story.scenarios).map {|scenario| Crab::CucumberScenario.new(opts[:language]).generate_from scenario }.join.strip
end
